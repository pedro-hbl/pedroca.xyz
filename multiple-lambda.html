<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light" />
    <meta name="generator" content="Marmite Retro Edition" />

    <title>How to trigger multiple AWS lambdas from a single S3 operation (Terraform approach) - Pedro Lopes</title>

    
<meta property="og:title" content="How to trigger multiple AWS lambdas from a single S3 operation (Terraform approach)">
<meta property="og:description" content=" Introduction In modern cloud architectures, it&#39;s common to have multiple services reacting to the s...">
<meta property="og:type" content="article">
<meta property="og:site_name" content="Pedro Lopes">


<meta property="article:author" content="Pedro Lopes">



    <!-- Retro Theme Styles -->
    <link rel="stylesheet" href="./static/css/retro-theme.css">
    <link rel="stylesheet" href="./static/css/windows95.css">
    <link rel="stylesheet" href="./static/css/curve-inspired.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./static/favicon.ico">

    
</head>
<body>
    <!-- Desktop with Retro Background -->
    <div class="desktop-wrapper">
        <!-- Main Window Chrome -->
        <div class="window-chrome">
            <!-- Title Bar -->
            <div class="title-bar">
                <span class="title-text">
                    Pedro Lopes - How to trigger multiple AWS lambdas from a single S3 operation (Terraform approach)
                </span>
                <div class="window-controls">
                    <button class="btn-minimize" aria-label="Minimize">_</button>
                    <button class="btn-maximize" aria-label="Maximize">‚ñ°</button>
                    <button class="btn-close" aria-label="Close">√ó</button>
                </div>
            </div>

            <!-- Menu Bar / Navigation -->
            <nav class="menu-bar">
                <a href="https://pedroca.xyz">Home</a>
                
                <a href="tags.html">Tags</a>
                
                <a href="archive.html">Archive</a>
                
                <a href="authors.html">Authors</a>
                
            </nav>

            <!-- Main Content Area -->
            <main class="content-area">
                
<article class="window-panel">
    <!-- Post Header -->
    <header class="post-header">
        <h1 class="post-title">How to trigger multiple AWS lambdas from a single S3 operation (Terraform approach)</h1>

        <div class="post-meta">
            

            
            <span class="post-author">
                üë§ by <a href="author-pedrohbl_.html">Pedro Lopes</a>
            </span>
            

            
            <div class="post-tags">
                
                
                <a href="tag-aws.html" class="retro-badge">aws</a>
                
                
                <a href="tag-lambda.html" class="retro-badge">lambda</a>
                
                
                <a href="tag-s3.html" class="retro-badge">s3</a>
                
                
                <a href="tag-eventbridge.html" class="retro-badge">eventbridge</a>
                
                
                <a href="tag-event.html" class="retro-badge">event</a>
                
            </div>
            
        </div>
    </header>

    <!-- Post Content -->
    <div class="post-content">
        <p>Feb 5, 2025 - ‚ßñ 2 min</p>
<h2 id="introduction">Introduction</h2>
<p>In modern cloud architectures, it's common to have multiple services reacting to the same event. For example, when a file is uploaded to an S3 bucket, you might want to trigger a notification service and also send the file metadata to a data mesh for compliance purposes. However, AWS S3 events are designed to trigger a single Lambda function by default. So, how can we trigger multiple Lambda functions from a single S3 operation?</p>
<p>In this post, we'll explore how to achieve this using <strong>AWS EventBridge</strong> and <strong>Terraform</strong>. By the end, you'll have a clear understanding of how to set up this architecture and deploy it using Infrastructure as Code (IaC).</p>
<hr />
<h2 id="use-case">Use Case</h2>
<p>To illustrate the situation and solutions, let's consider this use case:</p>
<ul>
<li><strong>AWS Lambda 1 - <em>Notification Service</em>:</strong> This lambda receives S3::PutObject operations to trigger a notification service for users.</li>
<li><strong>AWS Lambda 2 - <em>Mesh Service</em>:</strong> This lambda sends the S3::PutObject operation object and attributes to a data mesh team for compliance purposes.</li>
<li><strong>Bucket S3 - <em>active-contracts-bucket</em>:</strong> This is the source bucket that triggers both Lambda functions when an object is uploaded.</li>
<li><strong>EventBridge Notification - <em>multiple-lambda-trigger</em>:</strong> This is the event configuration that maps both Lambdas to the S3 operations.</li>
</ul>
<hr />
<h2 id="solution-overview">Solution Overview</h2>
<p>To trigger multiple Lambda functions from a single S3 operation, we'll use <strong>AWS EventBridge</strong>. EventBridge allows you to create event-driven architectures by routing events from various sources (like S3) to multiple targets (like Lambda functions). Here's how it works:</p>
<ol>
<li><strong>S3 Event Notification:</strong> When an object is uploaded to the S3 bucket, it sends an event to EventBridge.</li>
<li><strong>EventBridge Rule:</strong> A rule in EventBridge captures the S3 event and routes it to multiple Lambda functions.</li>
<li><strong>Lambda Functions:</strong> Both Lambda functions are triggered simultaneously, each performing its specific task.</li>
</ol>
<p>This approach decouples the S3 bucket from the Lambda functions, making the architecture more scalable and maintainable.</p>
<hr />
<h2 id="implementation-with-terraform">Implementation with Terraform</h2>
<p>Now, let's implement this solution using Terraform. Below is the step-by-step configuration:</p>
<h3 id="1-s3-bucket-configuration">1. S3 Bucket Configuration</h3>
<p>First, we'll create the S3 bucket that will trigger the event:</p>
<div class="codehilite"><pre><span></span><code><span class="n">resource</span><span class="w"> </span><span class="ss">&quot;aws_s3_bucket&quot;</span><span class="w"> </span><span class="ss">&quot;active_contracts_bucket&quot;</span><span class="w"> </span><span class="err">{</span>
<span class="w">  </span><span class="n">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;active-contracts-bucket&quot;</span>
<span class="w">  </span><span class="n">acl</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;private&quot;</span>
<span class="err">}</span>

<span class="o">&lt;</span><span class="err">!</span><span class="c1">-- Content Injected to every content markdown footer --&gt;</span>

<span class="o">[</span><span class="n">github</span><span class="o">]</span><span class="err">:</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">pedro</span><span class="o">-</span><span class="n">hbl</span>
</code></pre></div>

<ul>
<li><a href="author-pedrohbl_.html"><img alt="Pedro Lopes" src="https://s3.us-east-1.amazonaws.com/pedroca.io/pedropedroca.jpg" />
  Pedro Lopes</a></li>
</ul>
<p>Feb 5, 2025 - ‚ßñ 2 min</p>
<ul>
<li><a href="./tag-aws.html">aws</a></li>
<li><a href="./tag-lambda.html">lambda</a></li>
<li><a href="./tag-s3.html">s3</a></li>
<li><a href="./tag-eventbridge.html">eventbridge</a></li>
<li><a href="./tag-event.html">event</a></li>
</ul>
    </div>

    <!-- Post Footer with Navigation -->
    
    <footer class="post-footer" style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid rgba(255, 255, 255, 0.1);">
        <div style="display: flex; justify-content: space-between; gap: 1rem;">
            
            <a href="post1.html" class="button" style="flex: 1;">
                ‚Üê Understanding and Mitigating AWS Lambda Throttling in High-Concurrency Workloads
            </a>
            

            
            <a href="microservices-debt.html" class="button" style="flex: 1; text-align: right;">
                Microservices: Hidden Technical Debt (and how to possibly avoid the traps) ‚Üí
            </a>
            
        </div>
    </footer>
    

    <!-- Author Info -->
    
    <div class="curve-card" style="margin-top: 2rem; padding: 1.5rem;">
        <h3>About the Author</h3>
        <div style="display: flex; gap: 1rem; align-items: center;">
            
            <img src="https://s3.us-east-1.amazonaws.com/pedroca.io/pedropedroca.jpg" alt="Pedro Lopes" style="width: 60px; height: 60px; border-radius: 50%;">
            
            <div>
                <strong>Pedro Lopes</strong>
                <p style="margin: 0.5rem 0; color: var(--text-secondary);">Software Engineer =D</p>
                
                <div style="display: flex; gap: 0.5rem;">
                    
                    <a href="https://www.linkedin.com/in/pedro-lopes-4563a7196/" class="retro-badge" target="_blank" rel="noopener">Linkedin</a>
                    
                </div>
                
            </div>
        </div>
    </div>
    
</article>

<!-- Related Posts (if available) -->


            </main>

            <!-- Footer / Status Bar -->
            <footer class="status-bar">
                <div>Powered by <a href="https://github.com/rochacbruno/marmite">Marmite</a> | <small><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC-BY_NC-SA</a></small></div>
            </footer>
        </div>
    </div>

    <!-- Retro Effects & Main JavaScript -->
    <script src="./static/js/retro-effects.js"></script>
    <script src="./static/js/main.js"></script>

    
</body>
</html>